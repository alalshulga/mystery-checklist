<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ß–µ–∫-–ª–∏—Å—Ç —Ç–∞–π–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è - –§–∏—Ç–Ω–µ—Å-–∫–ª—É–±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f3f4f6;
      color: #111827;
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      padding: 20px;
      margin-bottom: 16px;
    }

    .header-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin: 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.08);
      color: #1d4ed8;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 10px;
    }

    .badge span.emoji {
      font-size: 14px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 8px;
      margin: 0 -8px 12px;
      border-bottom: 1px solid #e5e7eb;
      background: #f9fafb;
      -webkit-overflow-scrolling: touch;
    }

    .tab-btn {
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: #4b5563;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
    }

    .tab-btn span.icon {
      font-size: 14px;
    }

    .tab-btn.active {
      background: #0f766e;
      color: #ecfdf5;
      border-color: #0f766e;
      box-shadow: 0 4px 10px rgba(15, 118, 110, 0.25);
    }

    .tab-btn.disabled {
      opacity: 0.45;
      cursor: default;
    }

    .tab-btn:not(.disabled):active {
      transform: translateY(1px);
    }

    /* Form sections */
    .form-section {
      display: none;
      padding-top: 4px;
    }

    .form-section.active {
      display: block;
    }

    .section-title {
      font-size: 17px;
      font-weight: 600;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-subtitle {
      font-size: 12px;
      color: #6b7280;
      margin: 0 0 12px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 12px;
    }

    @media (min-width: 720px) {
      .form-grid.two-col {
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 500;
      color: #374151;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .field-label span.meta {
      font-size: 10px;
      color: #9ca3af;
      font-weight: 400;
    }

    .field-helper {
      font-size: 11px;
      color: #9ca3af;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 9px 11px;
      font-size: 13px;
      line-height: 1.4;
      color: #111827;
      background: #f9fafb;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    select:focus,
    textarea:focus {
      border-color: #0f766e;
      box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.2);
      background: #ffffff;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: #9ca3af;
      font-size: 12px;
    }

    /* Checkbox row */
    .check-row {
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .check-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-top: 2px;
      accent-color: #0f766e;
    }

    .check-row label {
      font-size: 13px;
      color: #374151;
      cursor: pointer;
    }

    /* Rating */
    .rating-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rating-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .rating-btn {
      min-width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      font-size: 13px;
      font-weight: 500;
      color: #374151;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
    }

    .rating-btn.selected {
      background: #0f766e;
      color: #ecfdf5;
      border-color: #0f766e;
      box-shadow: 0 3px 8px rgba(15, 118, 110, 0.25);
    }

    .rating-btn:active {
      transform: translateY(1px);
    }

    /* Buttons row */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    .left-actions,
    .right-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      padding: 9px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease, color 0.15s ease;
    }

    .btn-primary {
      background: #0f766e;
      color: #ecfdf5;
      box-shadow: 0 8px 20px rgba(15, 118, 110, 0.35);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(15, 118, 110, 0.35);
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-secondary:active {
      transform: translateY(1px);
    }

    .btn-ghost {
      background: transparent;
      color: #6b7280;
    }

    .btn-ghost:hover {
      background: #f3f4f6;
    }

    .btn[disabled] {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    /* Club info intro */
    .club-intro {
      font-size: 13px;
      color: #4b5563;
      margin: 8px 0 14px;
    }

    .club-intro strong {
      font-weight: 600;
      color: #111827;
    }

    /* Report */
    .report {
      display: none;
    }

    .report.active {
      display: block;
    }

    .report-header {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 12px;
      margin-bottom: 12px;
    }

    .report-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .report-meta {
      font-size: 12px;
      color: #6b7280;
    }

    .report-section {
      margin-bottom: 14px;
      padding-bottom: 10px;
      border-bottom: 1px dashed #e5e7eb;
    }

    .report-section:last-child {
      border-bottom: none;
    }

    .report-section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 0 0 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #111827;
    }

    .report-item {
      font-size: 13px;
      margin-bottom: 4px;
    }

    .report-item-label {
      font-weight: 500;
      color: #374151;
    }

    .report-item-value {
      color: #111827;
    }

    .report-empty {
      font-size: 12px;
      color: #9ca3af;
    }

    /* Small badge for step */
    .step-indicator {
      font-size: 11px;
      color: #6b7280;
    }

    @media (max-width: 600px) {
      .header-title {
        font-size: 18px;
      }
      .card {
        border-radius: 12px;
        padding: 16px;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="card">
    <h1 class="header-title">
      üïµÔ∏è‚Äç‚ôÇÔ∏è –ß–µ–∫-–ª–∏—Å—Ç —Ç–∞–π–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
    </h1>
    <p class="header-subtitle">
      –û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã —Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±–∞ –ø–æ 17 –∫–ª—é—á–µ–≤—ã–º –±–ª–æ–∫–∞–º: –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
    </p>
    <div class="badge">
      <span class="emoji">‚öôÔ∏è</span>
      <span>–í–µ—Ä—Å–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞)</span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="card" id="navCard">
    <div class="step-indicator" id="stepInfo"></div>
    <div class="tabs" id="tabs"></div>
  </div>

  <!-- Form -->
  <div class="card" id="formCard">
    <div id="formContainer"></div>
    <div class="actions">
      <div class="left-actions">
        <button class="btn btn-secondary" id="clearBtn" type="button">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
      </div>
      <div class="right-actions">
        <button class="btn btn-ghost" id="backToClubInfoBtn" type="button" style="display:none;">–ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—É–±–µ</button>
        <button class="btn btn-secondary" id="backSectionBtn" type="button">–ù–∞–∑–∞–¥</button>
        <button class="btn btn-primary" id="nextSectionBtn" type="button">–î–∞–ª–µ–µ</button>
        <button class="btn btn-primary" id="reportBtn" type="button">–ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á—ë—Ç</button>
      </div>
    </div>
  </div>

  <!-- Report -->
  <div class="card report" id="reportCard">
    <div class="report-header">
      <h2 class="report-title">üìä –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç —Ç–∞–π–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h2>
      <div class="report-meta" id="reportMeta"></div>
    </div>
    <div id="reportContent"></div>
    <div class="actions" style="margin-top: 16px;">
      <div class="left-actions">
        <button class="btn btn-secondary" id="editBtn" type="button">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–æ—Ä–º–µ</button>
      </div>
      <div class="right-actions">
        <button class="btn btn-ghost" id="printBtn" type="button">–ü–µ—á–∞—Ç—å / PDF</button>
      </div>
    </div>
  </div>
</div>

<script>
  // GLOBAL STATE - Never resets except when clearing
  const formState = {};
  let currentSectionIndex = 0;

  // All 17 sections (structure –∫–∞–∫ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏)
  const sections = [
    {
      id: 'club_info',
      name: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—É–±–µ',
      icon: 'üè¢',
      questions: [
        { id: 'club_name', type: 'text', label: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±–∞ *', placeholder: '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞', required: true },
        { id: 'club_address', type: 'text', label: '–ê–¥—Ä–µ—Å –∫–ª—É–±–∞', placeholder: '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å', required: false }
      ]
    },
    {
      id: 'location',
      name: '–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–∞—Ä–∫–æ–≤–∫–∞',
      icon: 'üìç',
      questions: [
        { id: 'loc_convenient', type: 'checkbox', label: '–£–¥–æ–±–Ω–æ–µ –º–µ—Å—Ç–æ—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ' },
        { id: 'loc_parking_available', type: 'checkbox', label: '–ü–∞—Ä–∫–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞' },
        { id: 'loc_parking_type', type: 'select', label: '–¢–∏–ø –ø–∞—Ä–∫–æ–≤–∫–∏', options: ['–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞', '–ü–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞', '–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞', '–ù–µ—Ç –ø–∞—Ä–∫–æ–≤–∫–∏'] },
        { id: 'loc_parking_distance', type: 'text', label: '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –≤—Ö–æ–¥–∞ (–º)' },
        { id: 'loc_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –ø–∞—Ä–∫–æ–≤–∫–µ –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏' }
      ]
    },
    {
      id: 'entrance',
      name: '–í—Ö–æ–¥–Ω–∞—è –≥—Ä—É–ø–ø–∞',
      icon: 'üö™',
      questions: [
        { id: 'ent_clean', type: 'checkbox', label: '–ß–∏—Å—Ç–∞—è –≤—Ö–æ–¥–Ω–∞—è –≥—Ä—É–ø–ø–∞' },
        { id: 'ent_greeting', type: 'checkbox', label: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ' },
        { id: 'ent_beverages', type: 'checkbox', label: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω—ã –Ω–∞–ø–∏—Ç–∫–∏' },
        { id: 'ent_beverage_type', type: 'select', label: '–ö–∞–∫–∏–µ –Ω–∞–ø–∏—Ç–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã', options: ['–í–æ–¥–∞', '–ß–∞–π', '–ö–æ—Ñ–µ', '–î—Ä—É–≥–æ–µ', '–ù–∏—á–µ–≥–æ'] },
        { id: 'ent_impression', type: 'rating', label: '–ü–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ (1-5)', max: 5 }
      ]
    },
    {
      id: 'waiting',
      name: '–û–∂–∏–¥–∞–Ω–∏–µ –∏ –≤—Å—Ç—Ä–µ—á–∞',
      icon: '‚è±Ô∏è',
      questions: [
        { id: 'wait_minutes', type: 'number', label: '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–º–∏–Ω)' },
        { id: 'wait_assessment', type: 'select', label: '–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è', options: ['–ü—Ä–∏–µ–º–ª–µ–º–æ (0-5)', '–ù–æ—Ä–º–∞–ª—å–Ω–æ (5-15)', '–î–æ–ª–≥–æ (15-30)', '–ù–µ–ø—Ä–∏–µ–º–ª–µ–º–æ (30+)'] },
        { id: 'wait_comfort', type: 'checkbox', label: '–ó–æ–Ω–∞ –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞' },
        { id: 'wait_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è' }
      ]
    },
    {
      id: 'manager_appearance',
      name: '–í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –º–µ–Ω–µ–¥–∂–µ—Ä–∞',
      icon: 'üëî',
      questions: [
        { id: 'mgr_suit', type: 'checkbox', label: '–î–µ–ª–æ–≤–æ–π –∫–æ—Å—Ç—é–º/—Ñ–æ—Ä–º–∞' },
        { id: 'mgr_clean', type: 'checkbox', label: '–û–ø—Ä—è—Ç–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥' },
        { id: 'mgr_badge', type: 'checkbox', label: '–ù–∞–ª–∏—á–∏–µ –±–µ–π–¥–∂–∞/–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞' },
        { id: 'mgr_fit', type: 'checkbox', label: '–í—ã–≥–ª—è–¥–∏—Ç –≤ —Ö–æ—Ä–æ—à–µ–π —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º–µ' },
        { id: 'mgr_appearance_rating', type: 'rating', label: '–û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ–± –æ–±—Ä–∞–∑–µ (1-5)', max: 5 },
        { id: 'mgr_communication', type: 'rating', label: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ (1-5)', max: 5 },
        { id: 'mgr_name', type: 'text', label: '–ò–º—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞' },
        { id: 'mgr_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –≤–Ω–µ—à–Ω–µ–º –≤–∏–¥–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º–µ' }
      ]
    },
    {
      id: 'needs_analysis',
      name: '–í—ã—è–≤–ª–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π',
      icon: 'üéØ',
      questions: [
        { id: 'need_goals', type: 'checkbox', label: '–°–ø—Ä–æ—Å–∏–ª –æ —Ü–µ–ª—è—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫' },
        { id: 'need_schedule', type: 'checkbox', label: '–°–ø—Ä–æ—Å–∏–ª –æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏/–≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è—Ç–∏–π' },
        { id: 'need_level', type: 'checkbox', label: '–°–ø—Ä–æ—Å–∏–ª –æ–± —É—Ä–æ–≤–Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏' },
        { id: 'need_questions', type: 'checkbox', label: '–ó–∞–¥–∞–ª —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã' },
        { id: 'need_listening', type: 'checkbox', label: '–ò—Å–∫—Ä–µ–Ω–Ω–µ —Å–ª—É—à–∞–ª –æ—Ç–≤–µ—Ç—ã' },
        { id: 'need_quality_rating', type: 'rating', label: '–ö–∞—á–µ—Å—Ç–≤–æ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (1-5)', max: 5 },
        { id: 'need_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π' }
      ]
    },
    {
      id: 'facility_tour',
      name: '–¢—É—Ä –ø–æ –∫–ª—É–±—É',
      icon: 'üèãÔ∏è',
      questions: [
        { id: 'tour_duration', type: 'number', label: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ (–º–∏–Ω)' },
        { id: 'tour_complete', type: 'checkbox', label: '–ü–æ–ª–Ω—ã–π —Ç—É—Ä –ø–æ –∫–ª—É–±—É' },
        { id: 'tour_logic', type: 'checkbox', label: '–õ–æ–≥–∏—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏' },
        { id: 'tour_pace', type: 'select', label: '–¢–µ–º–ø —Ç—É—Ä–∞', options: ['–°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ', '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ', '–°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ'] },
        { id: 'tour_explanations', type: 'rating', label: '–ö–∞—á–µ—Å—Ç–≤–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π (1-5)', max: 5 },
        { id: 'tour_cardio', type: 'text', label: '–ö–∞—Ä–¥–∏–æ—Ç—Ä–µ–Ω–∞–∂–µ—Ä—ã ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ' },
        { id: 'tour_weights', type: 'text', label: '–°–∏–ª–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ' },
        { id: 'tour_group_halls', type: 'text', label: '–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–ª—ã ‚Äî —Ä–∞–∑–º–µ—Ä –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' },
        { id: 'tour_changing_rooms', type: 'checkbox', label: '–†–∞–∑–¥–µ–≤–∞–ª–∫–∏ —á–∏—Å—Ç—ã–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã' },
        { id: 'tour_showers', type: 'checkbox', label: '–î—É—à–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –∏ —á–∏—Å—Ç—ã–µ' },
        { id: 'tour_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–æ–Ω –∏ —Ç—É—Ä–µ' }
      ]
    },
    {
      id: 'staff_intro',
      name: '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º',
      icon: 'üë•',
      questions: [
        { id: 'staff_trainers_introduced', type: 'checkbox', label: '–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç—Ä–µ–Ω–µ—Ä—ã' },
        { id: 'staff_trainers_count', type: 'number', label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–µ—Ä–æ–≤' },
        { id: 'staff_professional', type: 'checkbox', label: '–¢—Ä–µ–Ω–µ—Ä—ã –≤—ã–≥–ª—è–¥—è—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ' },
        { id: 'staff_friendly', type: 'checkbox', label: '–ü–µ—Ä—Å–æ–Ω–∞–ª –≤—ã–≥–ª—è–¥–∏—Ç –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º' },
        { id: 'staff_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –ø–µ—Ä—Å–æ–Ω–∞–ª–µ' }
      ]
    },
    {
      id: 'presentation',
      name: '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –∫–ª—É–±–∞',
      icon: 'üìä',
      questions: [
        { id: 'pres_history', type: 'checkbox', label: '–†–∞—Å—Å–∫–∞–∑–∞–ª –æ–± –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª—É–±–∞' },
        { id: 'pres_unique', type: 'checkbox', label: '–í—ã–¥–µ–ª–∏–ª —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞' },
        { id: 'pres_programs', type: 'checkbox', label: '–û–ø–∏—Å–∞–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —É—Å–ª—É–≥–∏' },
        { id: 'pres_materials', type: 'checkbox', label: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–±—É–∫–ª–µ—Ç—ã, –≤–∏–¥–µ–æ)' },
        { id: 'pres_style', type: 'select', label: '–°—Ç–∏–ª—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏', options: ['–£–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã–π', '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π', '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π', '–°–∫—É—á–Ω—ã–π', '–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π'] },
        { id: 'pres_enthusiasm', type: 'rating', label: '–≠–Ω—Ç—É–∑–∏–∞–∑–º –ø—Ä–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ (1-5)', max: 5 },
        { id: 'pres_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏' }
      ]
    },
    {
      id: 'competitors',
      name: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏',
      icon: '‚öîÔ∏è',
      questions: [
        { id: 'comp_mentioned', type: 'checkbox', label: '–£–ø–æ–º–∏–Ω–∞–ª –¥—Ä—É–≥–∏—Ö –∫–ª—É–±–æ–≤' },
        { id: 'comp_tone', type: 'select', label: '–¢–æ–Ω –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤', options: ['–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π', '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π', '–ö—Ä–∏—Ç–∏—á–Ω—ã–π', '–£–Ω–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π', '–ù–µ —É–ø–æ–º–∏–Ω–∞–ª'] },
        { id: 'comp_which', type: 'text', label: '–ö–∞–∫–∏–µ –∫–ª—É–±—ã –±—ã–ª–∏ —É–ø–æ–º—è–Ω—É—Ç—ã' },
        { id: 'comp_details', type: 'textarea', label: '–ß—Ç–æ –≥–æ–≤–æ—Ä–∏–ª –æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞—Ö' }
      ]
    },
    {
      id: 'pricing',
      name: '–¶–µ–Ω—ã –∏ —á–ª–µ–Ω—Å—Ç–≤–æ',
      icon: 'üí∞',
      questions: [
        { id: 'price_clear', type: 'checkbox', label: '–¶–µ–Ω—ã —á–µ—Ç–∫–æ –∏ —á–µ—Å—Ç–Ω–æ –∏–∑–ª–æ–∂–µ–Ω—ã' },
        { id: 'price_monthly', type: 'text', label: '–ú–µ—Å—è—á–Ω–æ–µ —á–ª–µ–Ω—Å—Ç–≤–æ (—Ä—É–±.)' },
        { id: 'price_annual', type: 'text', label: '–ì–æ–¥–æ–≤–æ–µ —á–ª–µ–Ω—Å—Ç–≤–æ (—Ä—É–±.)' },
        { id: 'price_annual_vip', type: 'text', label: '–ì–æ–¥–æ–≤–æ–µ —á–ª–µ–Ω—Å—Ç–≤–æ –í–ò–ü (—Ä—É–±.)' },
        { id: 'price_promos', type: 'checkbox', label: '–î–µ–π—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è' },
        { id: 'price_promos_desc', type: 'textarea', label: '–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–º–æ—Ü–∏–π' },
        { id: 'price_transparency', type: 'rating', label: '–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (1-5)', max: 5 },
        { id: 'price_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ —Ü–µ–Ω–∞—Ö' }
      ]
    },
    {
      id: 'sales_attempt',
      name: '–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫–ª—é—á–∏—Ç—å —Å–¥–µ–ª–∫—É',
      icon: 'ü§ù',
      questions: [
        { id: 'sales_offered', type: 'checkbox', label: '–ü—Ä–µ–¥–ª–æ–∂–∏–ª –æ—Ñ–æ—Ä–º–∏—Ç—å —á–ª–µ–Ω—Å—Ç–≤–æ' },
        { id: 'sales_persistence', type: 'select', label: '–ù–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è', options: ['–ù–µ –ø—Ä–µ–¥–ª–∞–≥–∞–ª', '–û–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ', '–ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑', '–ü–æ—Å—Ç–æ—è–Ω–Ω–æ'] },
        { id: 'sales_style', type: 'select', label: '–°—Ç–∏–ª—å –ø—Ä–æ–¥–∞–∂', options: ['–ú—è–≥–∫–∏–π', '–ê–∫—Ç–∏–≤–Ω—ã–π', '–ù–∞—Å—Ç–æ–π—á–∏–≤—ã–π', '–î–∞–≤—è—â–∏–π', '–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π'] },
        { id: 'sales_urgency', type: 'checkbox', label: '–°–æ–∑–¥–∞–≤–∞–ª —Å—Ä–æ—á–Ω–æ—Å—Ç—å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)' },
        { id: 'sales_pressure_rating', type: 'rating', label: '–£—Ä–æ–≤–µ–Ω—å –¥–∞–≤–ª–µ–Ω–∏—è (1-5)', max: 5 },
        { id: 'sales_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –ø–æ–ø—ã—Ç–∫–µ –ø—Ä–æ–¥–∞–∂–∏' }
      ]
    },
    {
      id: 'additional_services',
      name: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',
      icon: '‚ú®',
      questions: [
        { id: 'svc_personal_training', type: 'checkbox', label: '–£–ø–æ–º–∏–Ω–∞–ª –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏' },
        { id: 'svc_pt_price', type: 'text', label: '–¶–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (—Ä—É–±.)' },
        { id: 'svc_nutrition', type: 'checkbox', label: '–£–ø–æ–º–∏–Ω–∞–ª –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—é' },
        { id: 'svc_massage', type: 'checkbox', label: '–£–ø–æ–º–∏–Ω–∞–ª –º–∞—Å—Å–∞–∂/—Ñ–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—é' },
        { id: 'svc_other', type: 'text', label: '–î—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏' },
        { id: 'svc_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥–∞—Ö' }
      ]
    },
    {
      id: 'logistics',
      name: '–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ',
      icon: 'üìã',
      questions: [
        { id: 'log_registration', type: 'checkbox', label: '–û–±—ä—è—Å–Ω–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏' },
        { id: 'log_safety', type: 'checkbox', label: '–û–±—ä—è—Å–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏' },
        { id: 'log_documents', type: 'text', label: '–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç—Å—è' },
        { id: 'log_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è' }
      ]
    },
    {
      id: 'cleanliness',
      name: '–ß–∏—Å—Ç–æ—Ç–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ',
      icon: 'üßπ',
      questions: [
        { id: 'clean_floors', type: 'checkbox', label: '–ü–æ–ª—ã —á–∏—Å—Ç—ã–µ' },
        { id: 'clean_smell', type: 'checkbox', label: '–ù–µ—Ç –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ–≥–æ –∑–∞–ø–∞—Ö–∞' },
        { id: 'clean_equipment', type: 'checkbox', label: '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏' },
        { id: 'clean_changing', type: 'checkbox', label: '–†–∞–∑–¥–µ–≤–∞–ª–∫–∏ —á–∏—Å—Ç—ã–µ' },
        { id: 'clean_toilets', type: 'checkbox', label: '–¢—É–∞–ª–µ—Ç—ã —á–∏—Å—Ç—ã–µ' },
        { id: 'clean_showers', type: 'checkbox', label: '–î—É—à–µ–≤—ã–µ —á–∏—Å—Ç—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã' },
        { id: 'clean_ventilation', type: 'checkbox', label: '–•–æ—Ä–æ—à–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è/–∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ' },
        { id: 'clean_overall_rating', type: 'rating', label: '–û–±—â–∞—è —á–∏—Å—Ç–æ—Ç–∞ (1-5)', max: 5 },
        { id: 'clean_notes', type: 'textarea', label: '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ —á–∏—Å—Ç–æ—Ç–µ' }
      ]
    },
    {
      id: 'impressions',
      name: '–û–±—â–∏–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è',
      icon: 'üí≠',
      questions: [
        { id: 'impr_positives', type: 'textarea', label: '–ì–ª–∞–≤–Ω—ã–µ –ø–ª—é—Å—ã (3-5 –ø—É–Ω–∫—Ç–æ–≤)' },
        { id: 'impr_negatives', type: 'textarea', label: '–ì–ª–∞–≤–Ω—ã–µ –º–∏–Ω—É—Å—ã (3-5 –ø—É–Ω–∫—Ç–æ–≤)' },
        { id: 'impr_recommendations', type: 'textarea', label: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª—É–±–∞' }
      ]
    },
    {
      id: 'final_assessment',
      name: '–§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞',
      icon: '‚≠ê',
      questions: [
        { id: 'final_overall_rating', type: 'rating', label: '–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–ª—É–±–∞ (1-10)', max: 10 },
        { id: 'final_comparison', type: 'select', label: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –≤–∞—à–∏–º –∫–ª—É–±–æ–º', options: ['–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ', '–õ—É—á—à–µ', '–ù–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ', '–•—É–∂–µ', '–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ö—É–∂–µ'] },
        { id: 'final_recommendation', type: 'select', label: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è', options: ['–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é', '–†–µ–∫–æ–º–µ–Ω–¥—É—é', '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', '–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é', '–ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é'] },
        { id: 'final_advantages', type: 'textarea', label: '–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—à–µ–≥–æ –∫–ª—É–±–∞' },
        { id: 'final_improvements', type: 'textarea', label: '–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤ –Ω–∞—à–µ–º –∫–ª—É–±–µ' },
        { id: 'final_ideas', type: 'textarea', label: '–ù–æ–≤—ã–µ –∏–¥–µ–∏/–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏' },
        { id: 'final_notes', type: 'textarea', label: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è' },
        { id: 'visit_date', type: 'date', label: '–î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞' },
        { id: 'shopper_name', type: 'text', label: '–ò–º—è —Ç–∞–π–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è' }
      ]
    }
  ];

  function init() {
    renderTabs();
    renderSections();
    bindGlobalButtons();
    showSection(0);
  }

  function renderTabs() {
    const tabs = document.getElementById('tabs');
    tabs.innerHTML = '';
    sections.forEach((sec, index) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'tab-btn';
      if (index === 0) btn.classList.add('active');
      btn.dataset.index = String(index);
      btn.innerHTML = `<span class="icon">${sec.icon}</span><span>${index + 1}. ${sec.name}</span>`;
      btn.addEventListener('click', () => {
        showSection(index);
      });
      tabs.appendChild(btn);
    });
    updateStepInfo();
  }

  function renderSections() {
    const container = document.getElementById('formContainer');
    container.innerHTML = '';

    sections.forEach((sec, index) => {
      const div = document.createElement('div');
      div.className = 'form-section';
      div.id = `section-${sec.id}`;
      if (index === 0) div.classList.add('active');

      const isClubInfo = sec.id === 'club_info';

      div.innerHTML = `
        <h2 class="section-title">${sec.icon} ${sec.name}</h2>
        ${isClubInfo ? `
          <p class="club-intro">
            <strong>–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–ª—É–±–µ</strong>, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Ä–∞–∑–¥–µ–ª–∞–º –æ—Ü–µ–Ω–∫–∏.
          </p>
        ` : `
          <p class="section-subtitle">
            –†–∞–∑–¥–µ–ª ${index + 1} –∏–∑ ${sections.length}. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –æ—Ç–º–µ—á–∞—è —Ñ–∞–∫—Ç—ã –∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è.
          </p>
        `}
        <div class="form-grid">
        </div>
      `;

      const grid = div.querySelector('.form-grid');

      sec.questions.forEach(q => {
        const fieldWrap = document.createElement('div');
        fieldWrap.className = 'field';

        if (q.type === 'checkbox') {
          fieldWrap.innerHTML = `
            <div class="check-row">
              <input type="checkbox" id="${q.id}" data-field="${q.id}">
              <label for="${q.id}">${q.label}</label>
            </div>
          `;
        } else if (q.type === 'rating') {
          const max = q.max || 5;
          let btns = '';
          for (let i = 1; i <= max; i++) {
            btns += `<button type="button" class="rating-btn" data-field="${q.id}" data-value="${i}">${i}</button>`;
          }
          fieldWrap.innerHTML = `
            <div class="rating-row">
              <div class="field-label">${q.label}</div>
              <div class="rating-buttons">${btns}</div>
            </div>
          `;
        } else if (q.type === 'select') {
          const opts = (q.options || []).map(o => `<option value="${o}">${o}</option>`).join('');
          fieldWrap.innerHTML = `
            <label class="field-label" for="${q.id}">
              <span>${q.label}</span>
            </label>
            <select id="${q.id}" data-field="${q.id}">
              <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
              ${opts}
            </select>
          `;
        } else if (q.type === 'textarea') {
          fieldWrap.innerHTML = `
            <label class="field-label" for="${q.id}">
              <span>${q.label}</span>
            </label>
            <textarea id="${q.id}" data-field="${q.id}" placeholder="${q.placeholder || ''}"></textarea>
          `;
        } else {
          const typeAttr = q.type === 'number' ? 'number' : (q.type === 'date' ? 'date' : 'text');
          fieldWrap.innerHTML = `
            <label class="field-label" for="${q.id}">
              <span>${q.label}</span>
            </label>
            <input type="${typeAttr}" id="${q.id}" data-field="${q.id}" placeholder="${q.placeholder || ''}">
          `;
        }

        grid.appendChild(fieldWrap);
      });

      container.appendChild(div);
    });

    bindFieldEvents();
  }

  function bindFieldEvents() {
    const inputs = document.querySelectorAll('input[data-field], textarea[data-field], select[data-field]');
    inputs.forEach(el => {
      const save = () => saveFieldValue(el);
      el.addEventListener('input', save);
      el.addEventListener('change', save);
    });

    const ratingButtons = document.querySelectorAll('.rating-btn');
    ratingButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const fieldId = btn.dataset.field;
        const value = btn.dataset.value;
        const siblings = document.querySelectorAll(`.rating-btn[data-field="${fieldId}"]`);
        siblings.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        formState[fieldId] = value;
      });
    });
  }

  function saveFieldValue(el) {
    const fieldId = el.dataset.field;
    if (!fieldId) return;
    if (el.type === 'checkbox') {
      formState[fieldId] = el.checked;
    } else {
      formState[fieldId] = el.value;
    }
  }

  function restoreSectionValues(index) {
    const sec = sections[index];
    sec.questions.forEach(q => {
      const key = q.id;
      const value = formState[key];
      if (value === undefined) return;

      if (q.type === 'rating') {
        const btns = document.querySelectorAll(`.rating-btn[data-field="${key}"]`);
        btns.forEach(b => {
          b.classList.toggle('selected', String(b.dataset.value) === String(value));
        });
      } else if (q.type === 'checkbox') {
        const el = document.querySelector(`input[type="checkbox"][data-field="${key}"]`);
        if (el) el.checked = Boolean(value);
      } else {
        const el = document.querySelector(`[data-field="${key}"]`);
        if (el) el.value = value;
      }
    });
  }

  function showSection(index) {
    if (index < 0 || index >= sections.length) return;

    // simple validation for first section (club info)
    if (index > 0) {
      const nameVal = formState['club_name'];
      if (!nameVal || String(nameVal).trim() === '') {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ ¬´–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±–∞¬ª –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –¥—Ä—É–≥–∏–º —Ä–∞–∑–¥–µ–ª–∞–º.');
        index = 0;
      }
    }

    currentSectionIndex = index;

    const secs = document.querySelectorAll('.form-section');
    secs.forEach(s => s.classList.remove('active'));
    const targetId = sections[index].id;
    const target = document.getElementById(`section-${targetId}`);
    if (target) target.classList.add('active');

    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach((t, i) => {
      t.classList.toggle('active', i === index);
    });

    updateStepInfo();
    restoreSectionValues(index);
    updateSectionButtons();
  }

  function updateStepInfo() {
    const stepInfo = document.getElementById('stepInfo');
    const sec = sections[currentSectionIndex];
    stepInfo.textContent = `–†–∞–∑–¥–µ–ª ${currentSectionIndex + 1} –∏–∑ ${sections.length}: ${sec.icon} ${sec.name}`;
  }

  function updateSectionButtons() {
    const backBtn = document.getElementById('backSectionBtn');
    const nextBtn = document.getElementById('nextSectionBtn');
    const backClubInfoBtn = document.getElementById('backToClubInfoBtn');

    backBtn.disabled = currentSectionIndex === 0;
    nextBtn.disabled = currentSectionIndex === sections.length - 1;
    backClubInfoBtn.style.display = currentSectionIndex === 0 ? 'none' : 'inline-flex';
  }

  function bindGlobalButtons() {
    document.getElementById('backSectionBtn').addEventListener('click', () => {
      showSection(currentSectionIndex - 1);
    });

    document.getElementById('nextSectionBtn').addEventListener('click', () => {
      showSection(currentSectionIndex + 1);
    });

    document.getElementById('backToClubInfoBtn').addEventListener('click', () => {
      showSection(0);
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) return;
      for (const key in formState) {
        if (Object.prototype.hasOwnProperty.call(formState, key)) {
          delete formState[key];
        }
      }
      const inputs = document.querySelectorAll('input[data-field], textarea[data-field], select[data-field]');
      inputs.forEach(el => {
        if (el.type === 'checkbox') el.checked = false;
        else el.value = '';
      });
      const ratingButtons = document.querySelectorAll('.rating-btn');
      ratingButtons.forEach(btn => btn.classList.remove('selected'));
      showSection(0);
    });

    document.getElementById('reportBtn').addEventListener('click', () => {
      generateReport();
      showReportMode();
    });

    document.getElementById('editBtn').addEventListener('click', () => {
      showFormMode();
    });

    document.getElementById('printBtn').addEventListener('click', () => {
      window.print();
    });
  }

  function showReportMode() {
    document.getElementById('formCard').style.display = 'none';
    document.getElementById('navCard').style.display = 'none';
    document.getElementById('reportCard').classList.add('active');
  }

  function showFormMode() {
    document.getElementById('formCard').style.display = 'block';
    document.getElementById('navCard').style.display = 'block';
    document.getElementById('reportCard').classList.remove('active');
    // –ø–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –ø—Ä–æ—Å—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏
    restoreSectionValues(currentSectionIndex);
  }

  function generateReport() {
    const content = document.getElementById('reportContent');
    content.innerHTML = '';

    const clubName = formState['club_name'] || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
    const visitDate = formState['visit_date'] || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
    const shopperName = formState['shopper_name'] || '–ù–µ —É–∫–∞–∑–∞–Ω';

    const meta = document.getElementById('reportMeta');
    meta.textContent = `–ö–ª—É–±: ${clubName} | –î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞: ${visitDate} | –¢–∞–π–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å: ${shopperName}`;

    sections.forEach(sec => {
      const filled = sec.questions.some(q => {
        const v = formState[q.id];
        return v !== undefined && v !== '' && v !== false;
      });
      if (!filled) return;

      const secDiv = document.createElement('div');
      secDiv.className = 'report-section';
      secDiv.innerHTML = `<div class="report-section-title">${sec.icon} ${sec.name}</div>`;

      const itemsWrap = document.createElement('div');

      sec.questions.forEach(q => {
        const v = formState[q.id];
        if (v === undefined || v === '' || v === false) return;

        const item = document.createElement('div');
        item.className = 'report-item';
        let valueText;
        if (q.type === 'checkbox') {
          valueText = '–î–∞';
        } else {
          valueText = v;
        }

        item.innerHTML = `<span class="report-item-label">${q.label}:</span> <span class="report-item-value">${valueText}</span>`;
        itemsWrap.appendChild(item);
      });

      if (!itemsWrap.innerHTML) {
        const empty = document.createElement('div');
        empty.className = 'report-empty';
        empty.textContent = '–ù–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ.';
        itemsWrap.appendChild(empty);
      }

      secDiv.appendChild(itemsWrap);
      content.appendChild(secDiv);
    });

    if (!content.innerHTML) {
      content.innerHTML = '<p class="report-empty">–í—ã –µ—â—ë –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ –ø–æ–ª–µ.</p>';
    }
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
